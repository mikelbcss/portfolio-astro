---
import TimelineItem from './TimelineItem.astro';
interface Experience {
    title: string;
    dateStart: string;
    dateEnd: string;
    description: string[];
}

interface Props {
    experience: Experience[];
    step: any | number;
}

const { experience, step = -1 } = Astro.props;

let currentStep: number = step;
let activeStepsHeight: number = 0;
if (step === -1) {
    currentStep = experience.length - 1;
}
activeStepsHeight = (currentStep / experience.length) * 100;
---

<script lang="ts" is:inline>
    window.onload = function () {
        window.setTimeout(() => {
            const portfolioTimeline = document.querySelector('.portfolio-timeline');
            portfolioTimeline.classList.add('portfolio-timeline--loaded');
            console.log(portfolioTimeline);
        }, 500);
    };
</script>
<ol class=`portfolio-timeline` style=`--active-step-height:${activeStepsHeight}; --steps:${experience.length}`>
    {
        experience.map((item, index) => {
            let type = 'active';
            if (index === currentStep) {
                type = 'current';
            }
            if (index > currentStep) {
                type = 'disabled';
            }
            return (
                <li class="portfolio-timeline__item">
                    <TimelineItem experience={item} type={type} />
                </li>
            );
        })
    }
</ol>
<style lang="sass">
    .portfolio-timeline
        height: 100%
        position: relative
        display: flex
        flex-direction: column

        &::before,
        &::after
            top: 0
            position: absolute
            content: ''
            width: 4px
            border-radius: 20px

        &::before
            height: 100%
            background: grey

        &::after
            height: var(--active-height, 0)
            transition: height 1s ease-out
            background: purple

        &--loaded
            #{--active-height}: calc(var(--active-step-height) * 1% + 2.5em * var(--active-step-height) / 100)

        &__item
            height: max-content

        :not(:first-child)
            margin-top: 2.5em
</style>
